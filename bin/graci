#!/usr/bin/env python
"""
The main graci driver.
"""
import os
import sys as sys
import graci.utils.timing as timing
import graci.core.driver as driver
import graci.io.parse as parse
import graci.io.output as output

#
def main():
    """Runs a GRaCI computation."""

    # start the global timer
    timing.start('global')

    # read command line options
    read_cmdline()

    # parse input
    job_array = parse.parse_input()

    # print output file header
    output.print_header(job_array)

    # build and run computation 
    drive_obj = driver.Driver()
    drive_obj.run(job_array)

    # cleanup
    output.print_cleanup()

    return


def read_cmdline():
    """
    Read command line arguments
    Set relevant global variables.
    """

    output.file_names['input_file'] = sys.argv[1].strip()
    job_stub  = output.file_names['input_file'].split('.inp')[0]
    pyscf_out = job_stub+'.pyscf.out'
    two_int   = '2e_int.h5'
    one_int   = '1e_int.h5'

    if '-o' in sys.argv:
        out_file = sys.argv[sys.argv.index('-o')+1].strip()
    else:
        out_file   = None 
        #out_file  = job_stub+'.out'


    output.file_names['out_file']  = out_file
    output.file_names['pyscf_out'] = pyscf_out
    output.file_names['2ei']       = two_int
    output.file_names['1ei']       = one_int
    return

if __name__ == '__main__':

    # run the main routine
    main()

